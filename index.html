<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Johan Game</title>
<style>
body{
    margin:0;
    font-family:sans-serif;
    background:#13111c;
    color:white;
    overflow:hidden;
}
#menu{
    width:100%;
    display:flex;
    justify-content:space-around;
    background:#1d1b28;
    padding:10px;
}
.button{
    padding:10px 20px;
    background:#ff2ebd;
    border-radius:10px;
    cursor:pointer;
}
.screen{
    width:100vw;
    height:90vh;
    display:none;
    justify-content:center;
    align-items:center;
}

/* ===================== MINES ====================== */

#minesField{
    display:grid;
    grid-template-columns:repeat(5,70px);
    grid-gap:10px;
}
.mineTile{
    width:70px;
    height:70px;
    border-radius:10px;
    background:#2d2a3a;
    display:flex;
    justify-content:center;
    align-items:center;
    cursor:pointer;
    font-size:25px;
}
.mineTile.open{
    background:#16ff80;
}

#mineSettings{
    position:absolute;
    top:15px;
    left:15px;
}

/* ===================== PLINKO ====================== */

#plinkoCanvas{
    background:#100e17;
    border-radius:20px;
}

/* ===================== BALL ESCAPE ====================== */

#escapeCanvas{
    background:#100e17;
    border-radius:20px;
}

/* UI */
input,select{
    background:#2d2a3a;
    border:none;
    border-radius:5px;
    color:white;
    padding:5px;
}
</style>
</head>

<body>

<div id="menu">
    <div class="button" onclick="showMines()">Mines</div>
    <div class="button" onclick="showPlinko()">Plinko</div>
    <div class="button" onclick="showEscape()">Ball Escape</div>
</div>

<!-- MINES -->
<div id="mines" class="screen">
    <div>
        <div id="mineSettings">
            Mines:
            <select id="mineCount">
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
                <option>10</option>
            </select>
            Stake:
            <select id="mineStake">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
            </select>
        </div>

        <div id="minesField"></div>
    </div>
</div>

<!-- PLINKO -->
<div id="plinko" class="screen">
    <canvas id="plinkoCanvas" width="500" height="600"></canvas>
</div>

<!-- BALL ESCAPE -->
<div id="escape" class="screen">
    <canvas id="escapeCanvas" width="500" height="600"></canvas>
</div>

<script>

/*************** MENU ***************/

function hideAll(){
    document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
}
function showMines(){ hideAll(); document.getElementById("mines").style.display="flex"; }
function showPlinko(){ hideAll(); document.getElementById("plinko").style.display="flex"; }
function showEscape(){ hideAll(); document.getElementById("escape").style.display="flex"; }

showMines();

/*************** MINES GAME ***************/

let mineTiles=[];
function generateMines(){
    mineTiles=[];
    let field = document.getElementById("minesField");
    field.innerHTML="";
    let mineCount = Number(document.getElementById("mineCount").value);
    let mines = [];

    while(mines.length < mineCount){
        let r = Math.floor(Math.random()*25);
        if(!mines.includes(r)) mines.push(r);
    }

    for(let i=0;i<25;i++){
        let d=document.createElement("div");
        d.className="mineTile";
        d.onclick=()=>{

            if(mines.includes(i)){
                d.style.background="#ff0033";
                setTimeout(generateMines,900);
            }else{
                d.classList.add("open");
            }
        };
        field.appendChild(d);
    }
}
generateMines();

/*************** PLINKO ***************/

let pcanvas=document.getElementById("plinkoCanvas");
let pctx=pcanvas.getContext("2d");

let balls=[];
let pegs=[];

function initPlinko(){
    pegs=[];
    for(let y=50;y<500;y+=60){
        for(let x=60;x<440;x+=60){
            if((y/60)%2==0 && x>90 && x<410) continue;
            pegs.push({x,y});
        }
    }
}
initPlinko();

function spawnBall(){
    balls.push({x:250,y:10,dx:0,dy:1});
}
setInterval(spawnBall,2000);

function updatePlinko(){
    pctx.clearRect(0,0,pcanvas.width,pcanvas.height);

    for(let peg of pegs){
        pctx.beginPath();
        pctx.arc(peg.x,peg.y,8,0,Math.PI*2);
        pctx.fillStyle="#ff2ebd";
        pctx.fill();
    }

    for(let b of balls){
        b.dy+=0.05;
        b.x+=b.dx;
        b.y+=b.dy;

        for(let peg of pegs){
            let dx=b.x-peg.x;
            let dy=b.y-peg.y;
            let d=Math.sqrt(dx*dx+dy*dy);
            if(d<14){
                b.dy*=-1;
                b.dx=(Math.random()-0.5)*2;
            }
        }

        pctx.beginPath();
        pctx.arc(b.x,b.y,10,0,Math.PI*2);
        pctx.fillStyle="white";
        pctx.fill();
    }
    requestAnimationFrame(updatePlinko);
}
updatePlinko();

/*************** BALL ESCAPE ***************/

let ecanvas=document.getElementById("escapeCanvas");
let ectx=ecanvas.getContext("2d");

let angle=0;
let bx=250,by=250,bdx=3,bdy=4;

function updateEscape(){
    ectx.clearRect(0,0,500,600);

    angle+=0.02;

    ectx.save();
    ectx.translate(250,250);
    ectx.rotate(angle);

    ectx.beginPath();
    ectx.arc(0,0,200,0,Math.PI*2);
    ectx.strokeStyle="#ff2ebd";
    ectx.lineWidth=20;
    ectx.stroke();

    ectx.strokeStyle="#00ff66";
    ectx.beginPath();
    ectx.arc(0,0,200,0,0.7);
    ectx.stroke();

    ectx.restore();

    bx+=bdx;
    by+=bdy;

    if(Math.hypot(bx-250,by-250)>180){
        bdx*=-1;
        bdy*=-1;
    }

    ectx.beginPath();
    ectx.arc(bx,by,15,0,Math.PI*2);
    ectx.fillStyle="white";
    ectx.fill();

    requestAnimationFrame(updateEscape);
}
updateEscape();

</script>
</body>
</html>
