<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Johan Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --pink: #ff9ccd;
  --pink2: #ff6bb5;
  --bg: #12001f;
  --card: rgba(255,255,255,0.08);
  --win: #00ff9d;
  --lose: #ff4466;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:radial-gradient(circle at top,#2b0044,#12001f);
  color:var(--pink);
}
h1{
  text-align:center;
  margin:20px 0;
  font-size:2.8rem;
  background:linear-gradient(90deg,var(--pink),var(--pink2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.container{
  max-width:720px;
  margin:auto;
  padding:15px;
}
.card{
  background:var(--card);
  border-radius:20px;
  padding:20px;
  margin:20px 0;
  border:1px solid rgba(255,150,200,0.25);
  backdrop-filter:blur(8px);
}
button{
  padding:12px 26px;
  border:none;
  border-radius:50px;
  background:linear-gradient(45deg,var(--pink),var(--pink2));
  color:white;
  font-size:1.1rem;
  cursor:pointer;
  transition:.25s;
  margin:6px;
}
button:hover{transform:scale(1.05)}
button:disabled{opacity:.5;cursor:not-allowed}
input,select{
  padding:10px;
  border-radius:12px;
  border:2px solid var(--pink);
  background:transparent;
  color:var(--pink);
  font-size:1rem;
  margin:6px 0;
}
.nav{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
}
.balance{
  text-align:center;
  font-size:1.4rem;
  margin:10px 0;
}
/* MINES */
#grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
  margin-top:20px;
}
.cell{
  aspect-ratio:1;
  background:rgba(255,255,255,0.12);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2.2rem;
  cursor:pointer;
  transition:.2s;
}
.cell:hover{background:rgba(255,150,200,.25)}
/* CRASH */
canvas{
  width:100%;
  max-width:400px;
  height:420px;
  margin:20px auto;
  display:block;
  border-radius:18px;
  background:#080010;
  border:2px solid var(--pink2);
}
.mult{
  text-align:center;
  font-size:3.5rem;
  font-weight:bold;
  margin:10px 0;
  background:linear-gradient(90deg,var(--pink),#d946ef);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.controls{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:10px;
  margin-top:15px;
}
.message{
  text-align:center;
  font-size:1.2rem;
  margin:10px 0;
  padding:10px;
  border-radius:12px;
}
.win{background:rgba(0,255,157,0.2);border:1px solid var(--win)}
.lose{background:rgba(255,68,102,0.2);border:1px solid var(--lose)}
.countdown{
  text-align:center;
  font-size:2rem;
  margin:15px 0;
  color:var(--pink2);
}
</style>
</head>
<body>
<div class="container">
<h1>Johan Game</h1>
<div class="balance">Balance: <span id="bal">100.0</span> TON</div>

<div class="nav">
  <button onclick="show('mines')">Mines</button>
  <button onclick="show('crash')">Crash</button>
</div>

<!-- MINES -->
<div id="mines" class="card">
<h2>Mines</h2>
Bet: <input id="mbet" type="number" min="0.1" max="10" step="0.1" value="1">
Mines: <select id="mcount">
  <option>5</option><option>6</option><option>7</option>
  <option>8</option><option>9</option><option>10</option>
</select>
<div class="controls">
  <button onclick="startMines()">Start</button>
  <button id="cashM" onclick="cashMines()" disabled>Cash Out</button>
</div>
<p>Opened: <span id="opened">0</span> | x<span id="mm">1.00</span></p>
<div id="minesMsg" class="message"></div>
<div id="grid"></div>
</div>

<!-- CRASH -->
<div id="crash" class="card" style="display:none">
<h2>Crash</h2>
Bet: <input id="cbet" type="number" min="0.1" max="10" step="0.1" value="1">
<div class="controls">
  <button onclick="startCrash()">Start</button>
  <button id="cashC" onclick="cashCrash()" disabled>Cash Out</button>
</div>
<div id="countdown" class="countdown"></div>
<div class="mult" id="cm">1.00x</div>
<div id="crashMsg" class="message"></div>
<canvas id="cv" width="400" height="420"></canvas>
<div class="controls">
  <button onclick="startCrash()">New Game</button>
</div>
</div>

</div>

<script>
let bal=100;
const balEl=document.getElementById('bal');
function upd(){balEl.textContent=bal.toFixed(1)}
upd();

function show(id){
  document.querySelectorAll('.card').forEach(c=>c.style.display='none');
  document.getElementById(id).style.display='block';
}

// MINES
let mines=[],opened=0,multi=1,mbet=0;
const grid=document.getElementById('grid');
function startMines(){
  mbet=parseFloat(document.getElementById('mbet').value);
  if(isNaN(mbet)||mbet<0.1||mbet>10) return document.getElementById('minesMsg').textContent = "Bet 0.1-10 TON";
  if(bal<mbet) return document.getElementById('minesMsg').textContent = "No balance";
  bal-=mbet;upd();

  opened=0;multi=1;
  document.getElementById('opened').textContent=0;
  document.getElementById('mm').textContent="1.00";
  document.getElementById('cashM').disabled=false;
  document.getElementById('minesMsg').textContent='';
  document.getElementById('minesMsg').className='message';

  mines=[];
  const mc=parseInt(document.getElementById('mcount').value);
  while(mines.length<mc){
    let r=Math.floor(Math.random()*25);
    if(!mines.includes(r))mines.push(r);
  }

  grid.innerHTML="";
  for(let i=0;i<25;i++){
    let d=document.createElement('div');
    d.className="cell";
    d.textContent="?";
    d.onclick=()=>{
      if(d.dataset.open)return;
      d.dataset.open=true;
      if(mines.includes(i)){
        d.textContent="ðŸ’£";
        d.classList.add('lose');
        document.getElementById('cashM').disabled=true;
        document.getElementById('minesMsg').textContent=`BOOM! Lost ${mbet.toFixed(1)} TON`;
        document.getElementById('minesMsg').className="message lose";
      }else{
        d.textContent="ðŸ’Ž";
        d.classList.add('win');
        opened++;
        multi*=1.02;
        document.getElementById('opened').textContent=opened;
        document.getElementById('mm').textContent=multi.toFixed(2);
      }
    }
    grid.appendChild(d);
  }
}

function cashMines(){
  if(multi===1)return document.getElementById('minesMsg').textContent = "Open at least 1 cell";
  let win=mbet*(multi-1);
  bal+=win;upd();
  document.getElementById('cashM').disabled=true;
  document.getElementById('minesMsg').textContent=`Cashed! +${win.toFixed(1)} TON`;
  document.getElementById('minesMsg').className="message win";
}

// CRASH
const cv=document.getElementById('cv');
const ctx=cv.getContext("2d");
let cm=1,cr=false,bet=0,crashPoint=0,countdownTimer=0;
const countdownEl=document.getElementById('countdown');

function startCrash(){
  bet=parseFloat(document.getElementById('cbet').value);
  if(isNaN(bet)||bet<0.1||bet>10) return document.getElementById('crashMsg').textContent = "Bet 0.1-10 TON";
  if(bal<bet) return document.getElementById('crashMsg').textContent = "No balance";
  bal-=bet;upd();

  cm=1;cr=false;
  crashPoint=1+Math.random()*20; // 1-21x
  if(Math.random()<0.1)crashPoint=1; // 10% immediate crash
  document.getElementById('cm').textContent="1.00x";
  document.getElementById('cashC').disabled=true; // disable during countdown
  document.getElementById('crashMsg').textContent='';
  document.getElementById('crashMsg').className='message';

  // Countdown 5 sec
  countdownTimer = 5;
  countdownEl.textContent = "Countdown: 5s";
  const cdInterval = setInterval(() => {
    countdownTimer--;
    countdownEl.textContent = "Countdown: " + countdownTimer + "s";
    if (countdownTimer <= 0) {
      clearInterval(cdInterval);
      countdownEl.textContent = "";
      document.getElementById('cashC').disabled=false;
      animate();
    }
  }, 1000);

  // Simulate players joining
  setTimeout(() => console.log("Player2 joined with 0.5 TON"), 1500);
  setTimeout(() => console.log("Player3 joined with 1 TON"), 3000);
}

function animate(){
  if(cr)return;

  ctx.fillStyle="rgba(8,0,16,0.15)";
  ctx.fillRect(0,0,400,420);

  cm*=1.005; // slow growth
  document.getElementById('cm').textContent=cm.toFixed(2)+"x";

  if(cm>=crashPoint){
    cr=true;
    document.getElementById('cashC').disabled=true;
    document.getElementById('crashMsg').textContent=`CRASH at ${cm.toFixed(2)}x! Lost ${bet.toFixed(1)} TON`;
    document.getElementById('crashMsg').className="message lose";
    return;
  }

  // Rocket
  const y=420 - (cm * 20); // slow ascent
  ctx.save();
  ctx.translate(200, y);
  ctx.rotate(Math.sin(Date.now()*0.001) * 0.05);

  // Flame
  const fh=60+Math.sin(Date.now()*0.01)*15;
  const gr=ctx.createLinearGradient(0,0,0,fh);
  gr.addColorStop(0,"#ffff00");
  gr.addColorStop(0.4,"#ff8800");
  gr.addColorStop(1,"#ff0000");
  ctx.fillStyle=gr;
  ctx.beginPath();
  ctx.moveTo(0,40);
  ctx.quadraticCurveTo(-40,fh,0,fh+40);
  ctx.quadraticCurveTo(40,fh,0,40);
  ctx.fill();

  // Body
  ctx.fillStyle="#ff6bb5";
  ctx.beginPath();
  ctx.moveTo(0,-80);
  ctx.quadraticCurveTo(-30,-20,-25,40);
  ctx.lineTo(25,40);
  ctx.quadraticCurveTo(30,-20,0,-80);
  ctx.fill();

  // Window
  ctx.fillStyle="#88ddff";
  ctx.beginPath();
  ctx.arc(0,-30,12,0,Math.PI*2);
  ctx.fill();

  ctx.restore();

  requestAnimationFrame(animate);
}

function cashCrash(){
  if(cr)return;
  let win=bet*(cm-1);
  bal+=win;upd();
  cr=true;
  document.getElementById('cashC').disabled=true;
  document.getElementById('crashMsg').textContent=`Cashed! +${win.toFixed(1)} TON`;
  document.getElementById('crashMsg').className="message win";
}
</script>
</body>
</html>
