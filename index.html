<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Johan Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --pink: #ff9ccd;
  --pink-dark: #ff6bb5;
  --pink-bg: #ffe6f3;
  --green-win: #afffa6;
  --red-lose: #ff6b6b;
  --slot-bg: #f0f0f0;
}
body{
  margin:0;
  background:var(--pink-bg);
  font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
  text-align:center;
  user-select:none;
  color:#333;
}
h1{
  font-size: 48px;
  color: var(--pink-dark);
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  margin: 20px 0;
}
h2{
  font-size: 32px;
  color: var(--pink-dark);
}
h3{
  font-size: 24px;
  margin: 10px;
}
button{
  padding: 14px 28px;
  border-radius: 15px;
  border: none;
  background: var(--pink);
  color: #000;
  margin: 10px;
  cursor: pointer;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.2s;
}
button:hover{
  background: var(--pink-dark);
  transform: translateY(-2px);
}
button:active{
  transform: translateY(1px);
}
input[type="number"]{
  padding: 10px;
  border-radius: 10px;
  background: #fff;
  border: 1px solid var(--pink);
  font-size: 18px;
  margin: 10px;
  width: 100px;
}
select{
  padding: 10px;
  border-radius: 10px;
  background: #fff;
  border: 1px solid var(--pink);
  font-size: 18px;
  margin: 10px;
}
.screen{display:none;}
.active{display:block;}
.minecell{
  width: 60px;
  height: 60px;
  background: white;
  border-radius: 12px;
  font-size: 28px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: all 0.2s;
}
.minecell:hover{
  transform: scale(1.05);
}
#minesGrid{
  display: grid;
  grid-template-columns: repeat(5, 60px);
  gap: 8px;
  justify-content: center;
  margin: 20px auto;
}
canvas{
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  margin: 15px auto;
  display: block;
}
#ton{
  font-size: 28px;
  font-weight: bold;
  color: var(--pink-dark);
}
.slot{
  width: calc(320px / 7);
  height: 40px;
  background: var(--slot-bg);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  font-weight: bold;
  border: 1px solid #ddd;
}
#slots{
  display: flex;
  justify-content: center;
  margin-top: -50px;
  z-index: 1;
  position: relative;
}
.message{
  font-size: 20px;
  margin: 10px;
  padding: 10px;
  border-radius: 10px;
  color: #fff;
}
.message-win{
  background: var(--green-win);
  color: #000;
}
.message-lose{
  background: var(--red-lose);
}
</style>
</head>
<body>
<h1>Johan Game</h1>
<h3>TON: <span id="ton">100</span></h3>

<!-- MENU -->
<div id="menu" class="active">
  <button onclick="openLobby('mines')">Mines</button><br>
  <button onclick="openLobby('plinko')">Plinko</button><br>
  <button onclick="openLobby('escape')">Ball Escape</button>
</div>

<!-- MINES LOBBY -->
<div id="mines-lobby" class="screen">
  <h2>Mines Lobby</h2>
  <label>Bet (0.1-10 TON):</label>
  <input type="number" id="mines-bet" min="0.1" max="10" step="0.1" value="1"><br>
  <label>Number of Mines (5-10):</label>
  <select id="mines-count">
    <option value="5">5 Mines</option>
    <option value="6">6 Mines</option>
    <option value="7">7 Mines</option>
    <option value="8">8 Mines</option>
    <option value="9">9 Mines</option>
    <option value="10">10 Mines</option>
  </select><br>
  <button onclick="startMines()">Start Game</button>
  <button onclick="backToMenu()">‚Üê Back</button>
</div>

<!-- MINES GAME -->
<div id="mines-game" class="screen">
  <h2>Mines</h2>
  <p>Tiles opened: <span id="opened">0</span></p>
  <p>Multiplier: <span id="multi">1.00x</span></p>
  <div id="mines-message" class="message"></div>
  <button onclick="cashout()" style="background:#ff6bb5;">Cash Out üí∞</button>
  <div id="minesGrid"></div>
  <button onclick="backToLobby('mines')">‚Üê Back to Lobby</button>
</div>

<!-- PLINKO LOBBY -->
<div id="plinko-lobby" class="screen">
  <h2>Plinko Lobby</h2>
  <label>Bet (0.1-10 TON):</label>
  <input type="number" id="plinko-bet" min="0.1" max="10" step="0.1" value="1"><br>
  <button onclick="startPlinko()">Start Game</button>
  <button onclick="backToMenu()">‚Üê Back</button>
</div>

<!-- PLINKO GAME -->
<div id="plinko-game" class="screen">
  <h2>Plinko</h2>
  <div id="plinko-message" class="message"></div>
  <button onclick="dropBall()">Drop Ball üéæ</button>
  <canvas id="plinkoCanvas" width="320" height="520"></canvas>
  <div id="slots"></div>
  <button onclick="backToLobby('plinko')">‚Üê Back to Lobby</button>
</div>

<!-- ESCAPE LOBBY -->
<div id="escape-lobby" class="screen">
  <h2>Ball Escape Lobby</h2>
  <label>Bet (0.1-10 TON):</label>
  <input type="number" id="escape-bet" min="0.1" max="10" step="0.1" value="1"><br>
  <button onclick="startEscape()">Start Game</button>
  <button onclick="backToMenu()">‚Üê Back</button>
</div>

<!-- ESCAPE GAME -->
<div id="escape-game" class="screen">
  <h2>Ball Escape</h2>
  <div id="escape-message" class="message"></div>
  <canvas id="escapeCanvas" width="320" height="440"></canvas>
  <button onclick="backToLobby('escape')">‚Üê Back to Lobby</button>
</div>

<script>
let ton = 100;
document.getElementById("ton").textContent = ton.toFixed(1);

function openLobby(id){
  hideAll();
  document.getElementById(id + "-lobby").classList.add("active");
}

function backToMenu(){
  hideAll();
  document.getElementById("menu").classList.add("active");
}

function backToLobby(id){
  hideAll();
  document.getElementById(id + "-lobby").classList.add("active");
}

function hideAll(){
  document.querySelectorAll(".screen, #menu").forEach(x => x.classList.remove("active"));
}

function showMessage(id, text, type){
  let msg = document.getElementById(id + "-message");
  msg.innerHTML = text;
  msg.className = "message " + (type === "win" ? "message-win" : "message-lose");
  setTimeout(() => { msg.innerHTML = ""; }, 5000);
}

/**********************
   MINES GAME
**********************/
let mines = [];
let revealed = 0;
let multiplier = 1;
let currentBet = 1;
let mineCount = 5;

function startMines(){
  currentBet = parseFloat(document.getElementById("mines-bet").value);
  if(currentBet < 0.1 || currentBet > 10 || isNaN(currentBet)) return showMessage("mines", "Invalid bet! 0.1-10 TON.", "lose");
  mineCount = parseInt(document.getElementById("mines-count").value);
  if(ton < currentBet) return showMessage("mines", "Not enough TON!", "lose");
  ton -= currentBet;
  document.getElementById("ton").textContent = ton.toFixed(1);

  mines = [];
  revealed = 0;
  multiplier = 1;
  document.getElementById("opened").textContent = 0;
  document.getElementById("multi").textContent = "1.00x";

  while(mines.length < mineCount){
    let r = Math.floor(Math.random() * 25);
    if(!mines.includes(r)) mines.push(r);
  }

  let grid = document.getElementById("minesGrid");
  grid.innerHTML = "";
  for(let i = 0; i < 25; i++){
    let cell = document.createElement("div");
    cell.className = "minecell";
    cell.textContent = "?";
    cell.onclick = () => reveal(i, cell);
    grid.appendChild(cell);
  }

  hideAll();
  document.getElementById("mines-game").classList.add("active");
}

function reveal(i, cell){
  if(cell.dataset.open) return;

  if(mines.includes(i)){
    cell.style.background = "var(--red-lose)";
    cell.textContent = "üí£";
    showMessage("mines", `üí• BOOM! Lost ${currentBet.toFixed(1)} TON üòø`, "lose");
    setTimeout(() => backToLobby('mines'), 3000);
    return;
  }

  revealed++;
  multiplier = 1 + (revealed * (0.20 + (mineCount / 50)));
  cell.dataset.open = 1;
  cell.style.background = "var(--green-win)";
  cell.textContent = "üíé";
  cell.style.transform = "scale(1.1)";

  document.getElementById("opened").textContent = revealed;
  document.getElementById("multi").textContent = multiplier.toFixed(2) + "x";
}

function cashout(){
  if(revealed === 0) return showMessage("mines", "Open at least one tile first!", "lose");

  let win = (currentBet * multiplier).toFixed(1);
  ton += parseFloat(win);
  document.getElementById("ton").textContent = ton.toFixed(1);
  showMessage("mines", `üéâ Cashed out at ${multiplier.toFixed(2)}x! Won ${win} TON! üèÜ`, "win");
  setTimeout(() => backToLobby('mines'), 3000);
}

/**********************
   PLINKO GAME
**********************/
let plinkoBet = 1;
let multipliers = [2, 1.2, 0.8, 0.5, 0.8, 1.2, 2];

function startPlinko(){
  plinkoBet = parseFloat(document.getElementById("plinko-bet").value);
  if(plinkoBet < 0.1 || plinkoBet > 10 || isNaN(plinkoBet)) return showMessage("plinko", "Invalid bet! 0.1-10 TON.", "lose");
  if(ton < plinkoBet) return showMessage("plinko", "Not enough TON!", "lose");
  ton -= plinkoBet;
  document.getElementById("ton").textContent = ton.toFixed(1);

  let slotsDiv = document.getElementById("slots");
  slotsDiv.innerHTML = "";
  multipliers.forEach(m => {
    let slot = document.createElement("div");
    slot.className = "slot";
    slot.textContent = `x${m}`;
    slotsDiv.appendChild(slot);
  });

  hideAll();
  document.getElementById("plinko-game").classList.add("active");
}

function dropBall(){
  let canvas = document.getElementById("plinkoCanvas");
  let ctx = canvas.getContext("2d");
  let pegs = [];
  let rows = 9;

  for(let r = 0; r < rows; r++){
    let pegsInRow = r + 5;
    let offset = (canvas.width - (pegsInRow * 25)) / 2;
    for(let p = 0; p < pegsInRow; p++){
      pegs.push({
        x: offset + p * 25 + 12,
        y: 60 + r * 40
      });
    }
  }

  let ball = {x: canvas.width / 2, y: 20, vx: 0, vy: 0};
  let gravity = 0.3;
  let bounce = 0.6;
  let friction = 0.98;
  let ballRadius = 8;
  let slotWidth = canvas.width / multipliers.length;

  function animate(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#333";
    pegs.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
      ctx.fill();
    });

    ctx.fillStyle = "#ff6bb5";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ballRadius, 0, Math.PI*2);
    ctx.fill();

    ball.vy += gravity;
    ball.vy *= friction;
    ball.vx *= friction;
    ball.y += ball.vy;
    ball.x += ball.vx;

    pegs.forEach(p => {
      let dx = ball.x - p.x;
      let dy = ball.y - p.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < ballRadius + 5){
        let angle = Math.atan2(dy, dx);
        let speed = Math.sqrt(ball.vx**2 + ball.vy**2);
        ball.vx = -Math.cos(angle) * speed * bounce + (Math.random() - 0.5) * 1;
        ball.vy = -Math.sin(angle) * speed * bounce;
      }
    });

    if(ball.x < ballRadius || ball.x > canvas.width - ballRadius) ball.vx *= -bounce;

    if(ball.y > canvas.height - ballRadius - 20){
      let slotIndex = Math.floor(ball.x / slotWidth);
      slotIndex = Math.max(0, Math.min(multipliers.length - 1, slotIndex));
      let mult = multipliers[slotIndex];
      let points = (plinkoBet * mult).toFixed(1);
      ton += parseFloat(points);
      document.getElementById("ton").textContent = ton.toFixed(1);
      showMessage("plinko", `üéä Landed on x${mult}! +${points} TON!`, "win");
      setTimeout(() => backToLobby('plinko'), 3000);
      return;
    }

    requestAnimationFrame(animate);
  }
  animate();
}

/**********************
   BALL ESCAPE GAME
**********************/
let escapeBet = 1;

function startEscape(){
  escapeBet = parseFloat(document.getElementById("escape-bet").value);
  if(escapeBet < 0.1 || escapeBet > 10 || isNaN(escapeBet)) return showMessage("escape", "Invalid bet! 0.1-10 TON.", "lose");
  if(ton < escapeBet) return showMessage("escape", "Not enough TON!", "lose");
  ton -= escapeBet;
  document.getElementById("ton").textContent = ton.toFixed(1);

  let canvas = document.getElementById("escapeCanvas");
  let ctx = canvas.getContext("2d");
  let ball = {x: 160, y: 220, vx: 3, vy: -4};
  let rotation = 0;
  let holeStart = Math.random() * Math.PI * 2;
  let holeSize = 0.8;

  hideAll();
  document.getElementById("escape-game").classList.add("active");

  function animate(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "#ccc";
    ctx.lineWidth = 20;
    ctx.beginPath();
    ctx.arc(160, 220, 130, 0, Math.PI*2);
    ctx.stroke();

    ctx.strokeStyle = "#4caf50";
    ctx.lineWidth = 25;
    ctx.beginPath();
    ctx.arc(160, 220, 130, holeStart + rotation, holeStart + rotation + holeSize);
    ctx.stroke();

    ctx.fillStyle = "#ff6bb5";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 15, 0, Math.PI*2);
    ctx.fill();

    ball.x += ball.vx;
    ball.y += ball.vy;

    let dx = ball.x - 160;
    let dy = ball.y - 220;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist > 115){
      let angle = Math.atan2(dy, dx);
      ball.vx = -Math.cos(angle) * 6;
      ball.vy = -Math.sin(angle) * 6;
    }

    let ballAngle = Math.atan2(dy, dx);
    let normalizedBall = (ballAngle - holeStart - rotation + Math.PI*4) % (Math.PI*2);
    if(dist > 125 && normalizedBall < holeSize){
      let mult = 3; // Fixed multiplier for escape
      let win = (escapeBet * mult).toFixed(1);
      ton += parseFloat(win);
      document.getElementById("ton").textContent = ton.toFixed(1);
      showMessage("escape", `‚ö° BALL ESCAPED! +${win} TON! üèÜ`, "win");
      setTimeout(() => backToLobby('escape'), 3000);
      return;
    }

    rotation += 0.02;
    requestAnimationFrame(animate);
  }
  animate();
}
</script>
</body>
</html>
