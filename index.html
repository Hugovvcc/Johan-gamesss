<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Johan Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --pink: #ff9ccd;
  --pink-dark: #ff6bb5;
  --pink-bg: #ffe6f3;
  --green-win: #afffa6;
  --red-lose: #ff6b6b;
  --slot-bg: #f0f0f0;
}
body{
  margin:0;
  background:var(--pink-bg);
  font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
  text-align:center;
  user-select:none;
  color:#333;
}
h1{
  font-size: 48px;
  color: var(--pink-dark);
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  margin: 20px 0;
}
h2{
  font-size: 32px;
  color: var(--pink-dark);
}
h3{
  font-size: 24px;
  margin: 10px;
}
button{
  padding: 14px 28px;
  border-radius: 15px;
  border: none;
  background: var(--pink);
  color: #000;
  margin: 10px;
  cursor: pointer;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  transition: all 0.2s;
}
button:hover{
  background: var(--pink-dark);
  transform: translateY(-2px);
}
button:active{
  transform: translateY(1px);
}
.screen{display:none;}
.active{display:block;}
.minecell{
  width: 60px;
  height: 60px;
  background: white;
  border-radius: 12px;
  font-size: 28px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
  transition: all 0.2s;
}
.minecell:hover{
  transform: scale(1.05);
}
#minesGrid{
  display: grid;
  grid-template-columns: repeat(5, 60px);
  gap: 8px;
  justify-content: center;
  margin: 20px auto;
}
canvas{
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.2);
  margin: 15px auto;
  display: block;
}
#ton{
  font-size: 28px;
  font-weight: bold;
  color: var(--pink-dark);
}
.slot{
  width: calc(320px / 7);
  height: 40px;
  background: var(--slot-bg);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  font-weight: bold;
  border: 1px solid #ddd;
}
#slots{
  display: flex;
  justify-content: center;
  margin-top: -20px;
}
</style>
</head>
<body>
<h1>Johan Game</h1>
<h3>TON: <span id="ton">100</span></h3>

<!-- MENU -->
<div id="menu" class="active">
  <button onclick="openScreen('mines')">Mines</button><br>
  <button onclick="openScreen('plinko')">Plinko</button><br>
  <button onclick="openScreen('escape')">Ball Escape</button>
</div>

<!-- MINES -->
<div id="mines" class="screen">
  <h2>Mines</h2>
  <p>Tiles opened: <span id="opened">0</span></p>
  <p>Multiplier: <span id="multi">1.00x</span></p>
  <button onclick="startMines()">New Game</button>
  <button onclick="cashout()" style="background:#ff6bb5;">Cash Out üí∞</button>
  <div id="minesGrid"></div>
  <button onclick="back()">‚Üê Back</button>
</div>

<!-- PLINKO -->
<div id="plinko" class="screen">
  <h2>Plinko</h2>
  <button onclick="startPlinko()">Drop Ball üéæ</button>
  <canvas id="plinkoCanvas" width="320" height="520"></canvas>
  <div id="slots"></div>
  <button onclick="back()">‚Üê Back</button>
</div>

<!-- BALL ESCAPE -->
<div id="escape" class="screen">
  <h2>Ball Escape</h2>
  <button onclick="startEscape()">Play ‚ö°</button>
  <canvas id="escapeCanvas" width="320" height="440"></canvas>
  <button onclick="back()">‚Üê Back</button>
</div>

<script>
function openScreen(id){
  document.getElementById("menu").classList.remove("active");
  document.getElementById(id).classList.add("active");
}
function back(){
  document.querySelectorAll(".screen").forEach(x => x.classList.remove("active"));
  document.getElementById("menu").classList.add("active");
}

let ton = 100;
document.getElementById("ton").textContent = ton;

/**********************
   MINES GAME
**********************/
let mines = [];
let revealed = 0;
let multiplier = 1;

function startMines(){
  mines = [];
  revealed = 0;
  multiplier = 1;
  document.getElementById("opened").textContent = 0;
  document.getElementById("multi").textContent = "1.00x";

  while(mines.length < 8){
    let r = Math.floor(Math.random() * 25);
    if(!mines.includes(r)) mines.push(r);
  }

  let grid = document.getElementById("minesGrid");
  grid.innerHTML = "";
  for(let i = 0; i < 25; i++){
    let cell = document.createElement("div");
    cell.className = "minecell";
    cell.textContent = "?";
    cell.onclick = () => reveal(i, cell);
    grid.appendChild(cell);
  }
}

function reveal(i, cell){
  if(cell.dataset.open) return;

  if(mines.includes(i)){
    cell.style.background = "var(--red-lose)";
    cell.textContent = "üí£";
    alert("üí• BOOM! You hit a mine!\nLost 5 TON üòø");
    ton -= 5;
    if(ton < 0) ton = 0;
    document.getElementById("ton").textContent = ton;
    startMines();
    return;
  }

  revealed++;
  multiplier = 1 + (revealed * 0.20);
  cell.dataset.open = 1;
  cell.style.background = "var(--green-win)";
  cell.textContent = "üíé";
  cell.style.transform = "scale(1.1)";

  document.getElementById("opened").textContent = revealed;
  document.getElementById("multi").textContent = multiplier.toFixed(2) + "x";
}

function cashout(){
  if(revealed === 0) return alert("Open at least one tile first!");

  let win = Math.round(10 * multiplier);
  alert(`üéâ Cashed out at ${multiplier.toFixed(2)}x!\nYou won ${win} TON! üèÜ`);
  ton += win;
  document.getElementById("ton").textContent = ton;
  startMines();
}

/**********************
   PLINKO GAME
**********************/
function startPlinko(){
  let canvas = document.getElementById("plinkoCanvas");
  let ctx = canvas.getContext("2d");
  let pegs = [];
  let rows = 9;
  let multipliers = [2, 1.2, 0.8, 0.5, 0.8, 1.2, 2]; // x2 x1.2 x0.8 x0.5 x0.8 x1.2 x2
  let slotWidth = canvas.width / multipliers.length;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —è—á–µ–π–∫–∏
  let slotsDiv = document.getElementById("slots");
  slotsDiv.innerHTML = "";
  multipliers.forEach(m => {
    let slot = document.createElement("div");
    slot.className = "slot";
    slot.textContent = `x${m}`;
    slotsDiv.appendChild(slot);
  });

  // –ü–µ–≥–∏
  for(let r = 0; r < rows; r++){
    let pegsInRow = r + 5; // —à–∏—Ä–µ –¥–ª—è –ª—É—á—à–µ–π —Ñ–∏–∑–∏–∫–∏
    let offset = (canvas.width - (pegsInRow * 25)) / 2;
    for(let p = 0; p < pegsInRow; p++){
      pegs.push({
        x: offset + p * 25 + 12,
        y: 60 + r * 40
      });
    }
  }

  let ball = {x: canvas.width / 2, y: 20, vx: 0, vy: 0};
  let gravity = 0.2;
  let bounce = 0.6; // –º–µ–Ω—å—à–µ –æ—Ç—Å–∫–æ–∫–∞
  let friction = 0.98; // —Ç—Ä–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
  let dropped = false;

  function animate(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –ü–µ–≥–∏
    ctx.fillStyle = "#333";
    pegs.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 5, 0, Math.PI*2);
      ctx.fill();
    });

    // –®–∞—Ä–∏–∫
    ctx.fillStyle = "#ff6bb5";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 10, 0, Math.PI*2);
    ctx.fill();

    if(dropped){
      ball.vy += gravity;
      ball.vy *= friction;
      ball.vx *= friction;
      ball.y += ball.vy;
      ball.x += ball.vx;

      // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
      pegs.forEach(p => {
        let dx = ball.x - p.x;
        let dy = ball.y - p.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < 15){
          // –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–∏–∑–∏–∫–∞ –æ—Ç—Å–∫–æ–∫–∞
          let angle = Math.atan2(dy, dx);
          let speed = Math.sqrt(ball.vx**2 + ball.vy**2);
          ball.vx = -Math.cos(angle) * speed * bounce + (Math.random() - 0.5) * 1; // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–Ω–¥–æ–º
          ball.vy = -Math.sin(angle) * speed * bounce;
        }
      });

      // –°—Ç–µ–Ω—ã
      if(ball.x < 10 || ball.x > canvas.width - 10) ball.vx *= -bounce;

      // –î–Ω–æ
      if(ball.y > canvas.height - 30){
        let slotIndex = Math.floor(ball.x / slotWidth);
        slotIndex = Math.max(0, Math.min(multipliers.length - 1, slotIndex));
        let mult = multipliers[slotIndex];
        let points = Math.round(mult * 10); // –±–∞–∑–æ–≤—ã–π –≤—ã–∏–≥—Ä—ã—à 10 TON * mult
        ton += points;
        document.getElementById("ton").textContent = ton;
        alert(`üéä Landed on x${mult}!\n+${points} TON!`);
        return;
      }
    } else {
      dropped = true;
      ball.vy = 1; // –Ω–∞—á–∞–ª—å–Ω—ã–π –∏–º–ø—É–ª—å—Å
    }

    requestAnimationFrame(animate);
  }
  animate();
}

/**********************
   BALL ESCAPE GAME
**********************/
function startEscape(){
  let canvas = document.getElementById("escapeCanvas");
  let ctx = canvas.getContext("2d");
  let ball = {x: 160, y: 220, vx: 3, vy: -4};
  let rotation = 0;
  let holeStart = Math.random() * Math.PI * 2;
  let holeSize = 0.8;

  function animate(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "#ccc";
    ctx.lineWidth = 20;
    ctx.beginPath();
    ctx.arc(160, 220, 130, 0, Math.PI*2);
    ctx.stroke();

    ctx.strokeStyle = "#4caf50";
    ctx.lineWidth = 25;
    ctx.beginPath();
    ctx.arc(160, 220, 130, holeStart + rotation, holeStart + rotation + holeSize);
    ctx.stroke();

    ctx.fillStyle = "#ff6bb5";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 15, 0, Math.PI*2);
    ctx.fill();

    ball.x += ball.vx;
    ball.y += ball.vy;

    let dx = ball.x - 160;
    let dy = ball.y - 220;
    let dist = Math.sqrt(dx*dx + dy*dy);
    if(dist > 115){
      let angle = Math.atan2(dy, dx);
      ball.vx = -Math.cos(angle) * 6;
      ball.vy = -Math.sin(angle) * 6;
    }

    let ballAngle = Math.atan2(dy, dx);
    let normalizedBall = (ballAngle - holeStart - rotation + Math.PI*4) % (Math.PI*2);
    if(dist > 125 && normalizedBall < holeSize){
      ton += 15;
      document.getElementById("ton").textContent = ton;
      alert("‚ö° BALL ESCAPED! +15 TON! üèÜ");
      return;
    }

    rotation += 0.02;
    requestAnimationFrame(animate);
  }
  animate();
}
</script>
</body>
</html>
